<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/alpinejs/3.13.3/cdn.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.0/firebase-app-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.0/firebase-firestore-compat.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .glass-effect { backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.1); }
        .glow { box-shadow: 0 0 20px rgba(59, 130, 246, 0.3); }
    </style>
</head>
<body class="bg-gradient-to-br from-[#0f0f23] via-[#1a1a2e] to-[#16213e] min-h-screen text-white font-[Inter]">
    <div x-data="settingsApp()" class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">
                Advanced Settings
            </h1>
            <p class="text-gray-400 mt-2">Configure your browsing experience</p>
        </div>

        <!-- Status Display -->
        <div class="glass-effect rounded-lg p-4 mb-6 border border-gray-700">
            <div class="flex items-center justify-between">
                <span class="text-sm text-gray-300">Current Status:</span>
                <div class="flex items-center space-x-2">
                    <div class="w-3 h-3 rounded-full" :class="status.active ? 'bg-green-400' : 'bg-red-400'"></div>
                    <span x-text="status.message" class="text-sm"></span>
                </div>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="flex space-x-1 mb-6 glass-effect rounded-lg p-1 border border-gray-700">
            <template x-for="tab in tabs" :key="tab.id">
                <button 
                    @click="activeTab = tab.id"
                    :class="activeTab === tab.id ? 'bg-blue-600 text-white' : 'text-gray-400 hover:text-white'"
                    class="px-4 py-2 rounded-md transition-all duration-200 text-sm font-medium"
                    x-text="tab.name">
                </button>
            </template>
        </div>

        <!-- Tab Cloaker Section -->
        <div x-show="activeTab === 'cloaker'" class="space-y-6">
            <!-- About Blank Button -->
            <div class="glass-effect rounded-lg p-6 border border-gray-700">
                <h3 class="text-xl font-semibold mb-4 text-blue-400">Quick Actions</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <button @click="openAboutBlank()" class="bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 px-4 py-3 rounded-lg transition-all duration-200 glow">
                        Open About:Blank
                    </button>
                    <button @click="openBlobURL()" class="bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 px-4 py-3 rounded-lg transition-all duration-200">
                        Open Blob URL
                    </button>
                    <button @click="saveSettings()" class="bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 px-4 py-3 rounded-lg transition-all duration-200">
                        Save Settings
                    </button>
                </div>
            </div>

            <!-- Custom Tab Cloaker -->
            <div class="glass-effect rounded-lg p-6 border border-gray-700">
                <h3 class="text-xl font-semibold mb-4 text-blue-400">Custom Tab Cloaker</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Tab Title</label>
                        <input x-model="customCloaker.title" type="text" placeholder="Enter custom title" 
                               class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 focus:border-blue-500 focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Favicon URL</label>
                        <input x-model="customCloaker.favicon" type="text" placeholder="Enter favicon URL" 
                               class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 focus:border-blue-500 focus:outline-none">
                    </div>
                </div>
                <button @click="applyCloaker(customCloaker.title, customCloaker.favicon)" 
                        class="mt-4 bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg transition-colors duration-200">
                    Apply Custom Cloaker
                </button>
                
                <!-- Auto-open options -->
                <div class="mt-6 space-y-4">
                    <div class="flex items-center">
                        <input x-model="settings.autoAboutBlank" type="checkbox" id="autoAboutBlank" class="mr-3">
                        <label for="autoAboutBlank" class="text-sm">Automatically open in about:blank</label>
                    </div>
                    <div class="flex items-center">
                        <input x-model="settings.autoBlob" type="checkbox" id="autoBlob" class="mr-3">
                        <label for="autoBlob" class="text-sm">Automatically open in blob URL</label>
                    </div>
                </div>
            </div>

            <!-- Premade Tab Cloakers -->
            <div class="glass-effect rounded-lg p-6 border border-gray-700">
                <h3 class="text-xl font-semibold mb-4 text-blue-400">Premade Tab Cloakers</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <template x-for="cloaker in premadeCloakers" :key="cloaker.name">
                        <div class="bg-gray-800 rounded-lg p-4 hover:bg-gray-750 transition-colors duration-200 cursor-pointer"
                             @click="applyCloaker(cloaker.title, cloaker.favicon)">
                            <div class="flex items-center space-x-3">
                                <img :src="cloaker.favicon" :alt="cloaker.name" class="w-6 h-6">
                                <div>
                                    <div class="font-medium" x-text="cloaker.name"></div>
                                    <div class="text-sm text-gray-400" x-text="cloaker.title"></div>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </div>

        <!-- Panic Keys Section -->
        <div x-show="activeTab === 'panic'" class="space-y-6">
            <div class="glass-effect rounded-lg p-6 border border-gray-700">
                <h3 class="text-xl font-semibold mb-4 text-red-400">Panic Key Configuration</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3 mb-6">
                    <template x-for="letter in alphabet" :key="letter">
                        <button @click="togglePanicKey(letter)"
                                :class="panicKeys.includes(letter) ? 'bg-red-600 text-white' : 'bg-gray-700 text-gray-300'"
                                class="px-4 py-2 rounded-lg transition-colors duration-200 hover:bg-red-500"
                                x-text="letter">
                        </button>
                    </template>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Panic Action</label>
                    <select x-model="settings.panicAction" class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 focus:border-blue-500 focus:outline-none">
                        <option value="close">Close Tab</option>
                        <option value="google">Redirect to Google</option>
                        <option value="classroom">Redirect to Google Classroom</option>
                        <option value="blank">Open About:Blank</option>
                    </select>
                </div>
                
                <div class="text-sm text-gray-400">
                    Active panic keys: <span x-text="panicKeys.join(', ')" class="text-red-400"></span>
                </div>
            </div>
        </div>

        <!-- Teacher Prevention Section -->
        <div x-show="activeTab === 'prevention'" class="space-y-6">
            <div class="glass-effect rounded-lg p-6 border border-gray-700">
                <h3 class="text-xl font-semibold mb-4 text-yellow-400">Teacher Prevention</h3>
                
                <div class="space-y-4">
                    <div class="flex items-center justify-between">
                        <label class="text-sm font-medium">Disable Right Click</label>
                        <input x-model="settings.disableRightClick" type="checkbox" class="toggle">
                    </div>
                    
                    <div class="flex items-center justify-between">
                        <label class="text-sm font-medium">Disable F12 (Developer Tools)</label>
                        <input x-model="settings.disableF12" type="checkbox" class="toggle">
                    </div>
                    
                    <div class="flex items-center justify-between">
                        <label class="text-sm font-medium">Disable Ctrl+Shift+I</label>
                        <input x-model="settings.disableCtrlShiftI" type="checkbox" class="toggle">
                    </div>
                    
                    <div class="flex items-center justify-between">
                        <label class="text-sm font-medium">Disable Ctrl+U (View Source)</label>
                        <input x-model="settings.disableCtrlU" type="checkbox" class="toggle">
                    </div>
                    
                    <div class="flex items-center justify-between">
                        <label class="text-sm font-medium">Blur on Tab Switch</label>
                        <input x-model="settings.blurOnTabSwitch" type="checkbox" class="toggle">
                    </div>
                </div>
            </div>
        </div>

        <!-- Sync Section -->
        <div x-show="activeTab === 'sync'" class="space-y-6">
            <div class="glass-effect rounded-lg p-6 border border-gray-700">
                <h3 class="text-xl font-semibold mb-4 text-green-400">Cloud Sync</h3>
                
                <div class="space-y-4">
                    <div class="flex items-center justify-between">
                        <label class="text-sm font-medium">Auto Save</label>
                        <input x-model="settings.autoSave" type="checkbox" class="toggle">
                    </div>
                    
                    <div class="flex items-center justify-between">
                        <label class="text-sm font-medium">Cloud Sync</label>
                        <input x-model="settings.cloudSync" type="checkbox" class="toggle">
                    </div>
                </div>
                
                <div class="mt-6 flex space-x-4">
                    <button @click="syncToCloud()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg transition-colors duration-200">
                        Sync to Cloud
                    </button>
                    <button @click="loadFromCloud()" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg transition-colors duration-200">
                        Load from Cloud
                    </button>
                </div>
                
                <div class="mt-4 text-sm text-gray-400">
                    Last sync: <span x-text="lastSync"></span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC4ilHYP1T-kdXbWPoHJHhD2aj0pNWmMec",
            authDomain: "carbon-services.firebaseapp.com",
            projectId: "carbon-services",
            storageBucket: "carbon-services.firebasestorage.app",
            messagingSenderId: "288385472070",
            appId: "1:288385472070:web:c4be3ff186e248fc645c47",
            measurementId: "G-Y2K1RQYE74"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        function settingsApp() {
            return {
                activeTab: 'cloaker',
                tabs: [
                    { id: 'cloaker', name: 'Tab Cloaker' },
                    { id: 'panic', name: 'Panic Keys' },
                    { id: 'prevention', name: 'Teacher Prevention' },
                    { id: 'sync', name: 'Sync' }
                ],
                
                status: {
                    active: true,
                    message: 'All systems operational'
                },
                
                customCloaker: {
                    title: '',
                    favicon: ''
                },
                
                premadeCloakers: [
                    { name: 'Google', title: 'Google', favicon: 'https://www.google.com/favicon.ico' },
                    { name: 'Google Classroom', title: 'Google Classroom', favicon: 'https://ssl.gstatic.com/classroom/favicon.png' },
                    { name: 'Google Drive', title: 'Google Drive', favicon: 'https://ssl.gstatic.com/docs/doclist/images/drive_2022q3_32dp.png' },
                    { name: 'Gmail', title: 'Gmail', favicon: 'https://ssl.gstatic.com/ui/v1/icons/mail/rfr/gmail.ico' },
                    { name: 'YouTube', title: 'YouTube', favicon: 'https://www.youtube.com/favicon.ico' },
                    { name: 'Khan Academy', title: 'Khan Academy', favicon: 'https://www.khanacademy.org/favicon.ico' },
                    { name: 'Schoology', title: 'Schoology', favicon: 'https://www.schoology.com/favicon.ico' },
                    { name: 'Canvas', title: 'Canvas', favicon: 'https://www.instructure.com/favicon.ico' },
                    { name: 'Zoom', title: 'Zoom', favicon: 'https://zoom.us/favicon.ico' }
                ],
                
                alphabet: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split(''),
                panicKeys: ['Q', 'W'],
                
                settings: {
                    panicAction: 'google',
                    disableRightClick: false,
                    disableF12: false,
                    disableCtrlShiftI: false,
                    disableCtrlU: false,
                    blurOnTabSwitch: false,
                    autoSave: true,
                    cloudSync: false,
                    autoAboutBlank: false,
                    autoBlob: false
                },
                
                lastSync: 'Never',
                
                init() {
                    this.loadSettings();
                    this.setupEventListeners();
                    this.setupTeacherPrevention();
                    
                    // Auto-save functionality
                    this.$watch('settings', () => {
                        if (this.settings.autoSave) {
                            this.saveSettings();
                        }
                    }, { deep: true });
                },
                
                openAboutBlank() {
                    const newWindow = window.open('about:blank', '_blank');
                    if (newWindow) {
                        newWindow.document.write(`
                            <!DOCTYPE html>
                            <html>
                            <head><title>New Tab</title></head>
                            <body style="margin:0;padding:20px;font-family:Arial,sans-serif;background:#f5f5f5;">
                                <h1>About:Blank Page</h1>
                                <p>This page is running in about:blank mode.</p>
                            </body>
                            </html>
                        `);
                        newWindow.document.close();
                    }
                },
                
                openBlobURL() {
                    const html = `
                        <!DOCTYPE html>
                        <html>
                        <head><title>Blob URL</title></head>
                        <body style="margin:0;padding:20px;font-family:Arial,sans-serif;background:#f5f5f5;">
                            <h1>Blob URL Page</h1>
                            <p>This page is running from a blob URL.</p>
                        </body>
                        </html>
                    `;
                    const blob = new Blob([html], { type: 'text/html' });
                    const url = URL.createObjectURL(blob);
                    window.open(url, '_blank');
                },
                
                applyCloaker(title, favicon) {
                    document.title = title;
                    
                    // Update favicon
                    let link = document.querySelector("link[rel*='icon']") || document.createElement('link');
                    link.type = 'image/x-icon';
                    link.rel = 'shortcut icon';
                    link.href = favicon;
                    document.getElementsByTagName('head')[0].appendChild(link);
                    
                    this.status.message = `Cloaked as: ${title}`;
                },
                
                togglePanicKey(letter) {
                    const index = this.panicKeys.indexOf(letter);
                    if (index > -1) {
                        this.panicKeys.splice(index, 1);
                    } else {
                        this.panicKeys.push(letter);
                    }
                },
                
                setupEventListeners() {
                    // Panic key listeners
                    document.addEventListener('keydown', (e) => {
                        if (this.panicKeys.includes(e.key.toUpperCase())) {
                            this.executePanicAction();
                        }
                    });
                    
                    // Tab blur detection
                    document.addEventListener('visibilitychange', () => {
                        if (document.hidden && this.settings.blurOnTabSwitch) {
                            document.body.style.filter = 'blur(5px)';
                        } else {
                            document.body.style.filter = 'none';
                        }
                    });
                },
                
                setupTeacherPrevention() {
                    document.addEventListener('contextmenu', (e) => {
                        if (this.settings.disableRightClick) {
                            e.preventDefault();
                        }
                    });
                    
                    document.addEventListener('keydown', (e) => {
                        if (this.settings.disableF12 && e.key === 'F12') {
                            e.preventDefault();
                        }
                        if (this.settings.disableCtrlShiftI && e.ctrlKey && e.shiftKey && e.key === 'I') {
                            e.preventDefault();
                        }
                        if (this.settings.disableCtrlU && e.ctrlKey && e.key === 'u') {
                            e.preventDefault();
                        }
                    });
                },
                
                executePanicAction() {
                    switch (this.settings.panicAction) {
                        case 'close':
                            window.close();
                            break;
                        case 'google':
                            window.location.href = 'https://www.google.com';
                            break;
                        case 'classroom':
                            window.location.href = 'https://classroom.google.com';
                            break;
                        case 'blank':
                            this.openAboutBlank();
                            break;
                    }
                },
                
                saveSettings() {
                    const settingsData = {
                        settings: this.settings,
                        panicKeys: this.panicKeys,
                        customCloaker: this.customCloaker
                    };
                    
                    // Save to localStorage
                    localStorage.setItem('advancedSettings', JSON.stringify(settingsData));
                    
                    // Save to cloud if enabled
                    if (this.settings.cloudSync) {
                        this.syncToCloud();
                    }
                    
                    this.status.message = 'Settings saved successfully';
                    setTimeout(() => {
                        this.status.message = 'All systems operational';
                    }, 2000);
                },
                
                loadSettings() {
                    const saved = localStorage.getItem('advancedSettings');
                    if (saved) {
                        const data = JSON.parse(saved);
                        this.settings = { ...this.settings, ...data.settings };
                        this.panicKeys = data.panicKeys || this.panicKeys;
                        this.customCloaker = data.customCloaker || this.customCloaker;
                    }
                },
                
                async syncToCloud() {
                    try {
                        const settingsData = {
                            settings: this.settings,
                            panicKeys: this.panicKeys,
                            customCloaker: this.customCloaker,
                            timestamp: new Date().toISOString()
                        };
                        
                        await db.collection('userSettings').doc('default').set(settingsData);
                        this.lastSync = new Date().toLocaleString();
                        this.status.message = 'Synced to cloud successfully';
                    } catch (error) {
                        console.error('Sync error:', error);
                        this.status.message = 'Cloud sync failed';
                    }
                },
                
                async loadFromCloud() {
                    try {
                        const doc = await db.collection('userSettings').doc('default').get();
                        if (doc.exists) {
                            const data = doc.data();
                            this.settings = { ...this.settings, ...data.settings };
                            this.panicKeys = data.panicKeys || this.panicKeys;
                            this.customCloaker = data.customCloaker || this.customCloaker;
                            this.lastSync = new Date(data.timestamp).toLocaleString();
                            this.status.message = 'Loaded from cloud successfully';
                        }
                    } catch (error) {
                        console.error('Load error:', error);
                        this.status.message = 'Cloud load failed';
                    }
                }
            }
        }
    </script>
</body>
</html>