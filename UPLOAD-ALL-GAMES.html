<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload All 67 Games to Firebase</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        h1 {
            font-size: 2.5em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        .status {
            font-size: 1.2em;
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            font-weight: bold;
        }
        .loading { background: rgba(255, 193, 7, 0.3); }
        .success { background: rgba(40, 167, 69, 0.3); }
        .error { background: rgba(220, 53, 69, 0.3); }
        .progress {
            width: 100%;
            height: 25px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 15px;
        }
        .counter {
            font-size: 2em;
            font-weight: bold;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        .details {
            margin: 20px 0;
            font-size: 1.1em;
            line-height: 1.6;
        }
        .game-list {
            max-height: 200px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            text-align: left;
        }
        .game-item {
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .game-item:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ Firebase Game Upload</h1>
        <div id="counter" class="counter">0 / 67</div>
        <div id="status" class="status loading">Initializing Firebase...</div>
        <div class="progress">
            <div id="progressBar" class="progress-bar"></div>
        </div>
        <div id="details" class="details"></div>
        <div id="gameList" class="game-list" style="display: none;"></div>
    </div>

    <!-- Firebase SDK v8 -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <script>
        // Your actual Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC4ilHYP1T-kdXbWPoHJHhD2aj0pNWmMec",
            authDomain: "carbon-services.firebaseapp.com",
            databaseURL: "https://carbon-services-default-rtdb.firebaseio.com",
            projectId: "carbon-services",
            storageBucket: "carbon-services.firebasestorage.app",
            messagingSenderId: "288385472070",
            appId: "1:288385472070:web:c4be3ff186e248fc645c47",
            measurementId: "G-Y2K1RQYE74"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // UI Elements
        const statusEl = document.getElementById('status');
        const progressEl = document.getElementById('progressBar');
        const counterEl = document.getElementById('counter');
        const detailsEl = document.getElementById('details');
        const gameListEl = document.getElementById('gameList');

        function updateStatus(message, type = 'loading') {
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
        }

        function updateProgress(current, total) {
            const percent = (current / total) * 100;
            progressEl.style.width = percent + '%';
            counterEl.textContent = `${current} / ${total}`;
        }

        function addGameToList(gameName, status) {
            const gameItem = document.createElement('div');
            gameItem.className = 'game-item';
            gameItem.innerHTML = `${status === 'success' ? '‚úÖ' : '‚ùå'} ${gameName}`;
            gameListEl.appendChild(gameItem);
            gameListEl.scrollTop = gameListEl.scrollHeight;
        }

        // Auto-start upload
        async function uploadAllGames() {
            try {
                updateStatus('üî• Loading games data...', 'loading');
                
                // Fetch games from your games.json
                const response = await fetch('./games.json');
                const gamesJsonData = await response.json();
                const gamesArray = gamesJsonData.games || gamesJsonData;

                updateStatus(`üì§ Starting upload of ${gamesArray.length} games...`, 'loading');
                gameListEl.style.display = 'block';
                
                let uploaded = 0;
                let failed = 0;

                // Process and upload each game
                for (let i = 0; i < gamesArray.length; i++) {
                    const game = gamesArray[i];
                    
                    try {
                        const gameId = game.directory.replace('games/', '').replace(/[^a-zA-Z0-9-_]/g, '-');
                        
                        const gameDoc = {
                            id: gameId,
                            title: game.name,
                            name: game.name,
                            directory: game.directory,
                            path: game.path,
                            category: 'action',
                            image: `https://via.placeholder.com/400x300/00d4ff/ffffff?text=${encodeURIComponent(game.name)}`,
                            description: `Play ${game.name} - HTML5 game from YouTube Playables`,
                            featured: i < 3,
                            url: `./games/${gameId}/index.html`,
                            developer: 'YouTube Playables',
                            release: '2024',
                            technology: 'HTML5',
                            platforms: ['Browser'],
                            tags: ['html5', 'youtube-playables', 'browser-game'],
                            controls: 'Mouse and keyboard controls',
                            playCount: 0,
                            avgRating: 0,
                            totalPlaytime: 0,
                            active: true,
                            addedAt: firebase.firestore.FieldValue.serverTimestamp(),
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        };
                        
                        await db.collection('games').doc(gameId).set(gameDoc);
                        uploaded++;
                        addGameToList(game.name, 'success');
                        
                        updateProgress(uploaded + failed, gamesArray.length);
                        updateStatus(`üì§ Uploading... (${uploaded}/${gamesArray.length})`, 'loading');
                        
                        // Small delay to prevent overwhelming Firebase
                        await new Promise(resolve => setTimeout(resolve, 100));
                        
                    } catch (error) {
                        console.error(`Failed to upload ${game.name}:`, error);
                        failed++;
                        addGameToList(game.name, 'error');
                        updateProgress(uploaded + failed, gamesArray.length);
                    }
                }

                // Upload metadata
                try {
                    await db.collection('metadata').doc('games').set({
                        totalGames: gamesArray.length,
                        uploadedGames: uploaded,
                        failedGames: failed,
                        source: 'https://github.com/bubbls/youtube-playables',
                        description: 'Collection of YouTube Playable games',
                        lastUpdated: firebase.firestore.FieldValue.serverTimestamp(),
                        uploadedAt: firebase.firestore.FieldValue.serverTimestamp(),
                        version: '1.0'
                    });
                } catch (error) {
                    console.error('Metadata upload failed:', error);
                }

                // Final results
                updateStatus(`üéâ Upload Complete! ${uploaded} games uploaded successfully`, 'success');
                detailsEl.innerHTML = `
                    <div>‚úÖ Successfully uploaded: <strong>${uploaded} games</strong></div>
                    <div>‚ùå Failed uploads: <strong>${failed} games</strong></div>
                    <div>üìä Total processed: <strong>${gamesArray.length} games</strong></div>
                    <br>
                    <div>üîÑ <a href="games.html" style="color: #fff; text-decoration: underline;">Go to Games Page</a> to see your uploaded games!</div>
                `;

                // Verify upload
                setTimeout(async () => {
                    try {
                        const snapshot = await db.collection('games').get();
                        detailsEl.innerHTML += `<br><div>üîç Verification: <strong>${snapshot.size} games</strong> found in Firebase</div>`;
                    } catch (error) {
                        console.error('Verification failed:', error);
                    }
                }, 2000);

            } catch (error) {
                console.error('Upload error:', error);
                updateStatus('‚ùå Upload failed: ' + error.message, 'error');
                detailsEl.innerHTML = `<div style="color: #ff6b6b;">Error: ${error.message}</div>`;
            }
        }

        // Start upload automatically when page loads
        window.addEventListener('load', () => {
            updateStatus('üöÄ Starting automatic upload...', 'loading');
            setTimeout(uploadAllGames, 1500); // Small delay for better UX
        });
    </script>
</body>
</html>