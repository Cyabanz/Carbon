<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Iframe Compatibility Diagnostic - CARBON Games</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
</head>
<body class="bg-gray-900 text-white p-8">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-3xl font-bold mb-8 text-center">
            <i class="bx bx-bug"></i>
            Iframe Compatibility Diagnostic
        </h1>
        
        <!-- Problem Explanation -->
        <div class="bg-red-900/20 border border-red-500/30 rounded-lg p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4 text-red-400">
                <i class="bx bx-error-circle"></i>
                Iframe Loading Issues Identified
            </h2>
            <div class="space-y-3 text-gray-300">
                <p><strong>Root Cause:</strong> Most games use external base URLs (CDNs) which cause CORS and CSP issues in iframes.</p>
                <p><strong>Examples Found:</strong></p>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li><code>&lt;base href="https://cdn.jsdelivr.net/gh/bubbls/youtube-playables@main/bowmasters/"&gt;</code></li>
                    <li><code>&lt;base href="https://cdn.jsdelivr.net/gh/bubbls/youtube-playables@main/amaze/"&gt;</code></li>
                    <li>And 50+ other games with similar patterns</li>
                </ul>
            </div>
        </div>

        <!-- Solution Implemented -->
        <div class="bg-green-900/20 border border-green-500/30 rounded-lg p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4 text-green-400">
                <i class="bx bx-check-circle"></i>
                Auto-Fallback System Implemented
            </h2>
            <div class="grid md:grid-cols-2 gap-6">
                <div>
                    <h3 class="font-semibold text-green-300 mb-2">Detection Methods:</h3>
                    <ul class="space-y-1 text-gray-300 text-sm">
                        <li>• <strong>Load Timeout:</strong> 8-second iframe load timeout</li>
                        <li>• <strong>Error Handler:</strong> Catches iframe failures</li>
                        <li>• <strong>Content Analysis:</strong> Scans for external base URLs</li>
                        <li>• <strong>CORS Detection:</strong> Identifies cross-origin issues</li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-semibold text-green-300 mb-2">Auto-Fallback Actions:</h3>
                    <ul class="space-y-1 text-gray-300 text-sm">
                        <li>• <strong>Loading Overlay:</strong> Shows loading progress</li>
                        <li>• <strong>Error Message:</strong> Explains the issue</li>
                        <li>• <strong>Redirect Options:</strong> "Open in New Tab" button</li>
                        <li>• <strong>Retry Option:</strong> "Try Again" button</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Test Games -->
        <div class="bg-gray-800 rounded-lg p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4 text-blue-400">
                <i class="bx bx-test-tube"></i>
                Test Problematic Games
            </h2>
            <div class="grid md:grid-cols-3 gap-4">
                <a href="play.html?id=16" class="block bg-red-600 hover:bg-red-700 px-4 py-3 rounded-lg transition-colors text-center">
                    <i class="bx bx-error mr-2"></i>
                    Bowmasters (CDN Issue)
                </a>
                <a href="play.html?id=15" class="block bg-red-600 hover:bg-red-700 px-4 py-3 rounded-lg transition-colors text-center">
                    <i class="bx bx-error mr-2"></i>
                    Amaze (CDN Issue)
                </a>
                <a href="play.html?id=32" class="block bg-red-600 hover:bg-red-700 px-4 py-3 rounded-lg transition-colors text-center">
                    <i class="bx bx-error mr-2"></i>
                    Pou (CDN Issue)
                </a>
                <a href="play.html?id=1" class="block bg-red-600 hover:bg-red-700 px-4 py-3 rounded-lg transition-colors text-center">
                    <i class="bx bx-error mr-2"></i>
                    3D Bowling (CDN Issue)
                </a>
                <a href="play.html?id=35" class="block bg-red-600 hover:bg-red-700 px-4 py-3 rounded-lg transition-colors text-center">
                    <i class="bx bx-error mr-2"></i>
                    Basketball FRVR (CDN Issue)
                </a>
                <a href="play.html?id=42" class="block bg-red-600 hover:bg-red-700 px-4 py-3 rounded-lg transition-colors text-center">
                    <i class="bx bx-error mr-2"></i>
                    Magic Tiles 3 (CDN Issue)
                </a>
            </div>
        </div>

        <!-- Technical Details -->
        <div class="bg-gray-800 rounded-lg p-6">
            <h2 class="text-xl font-semibold mb-4 text-purple-400">
                <i class="bx bx-code"></i>
                Technical Implementation Details
            </h2>
            <div class="space-y-4 text-sm text-gray-300">
                <div>
                    <h3 class="font-semibold text-purple-300 mb-2">Iframe Error Detection:</h3>
                    <pre class="bg-gray-900 p-3 rounded overflow-x-auto"><code>iframe.onload = () => clearTimeout(loadTimeout);
iframe.onerror = () => showRedirectFallback();
setTimeout(() => showFallback(), 8000); // 8s timeout</code></pre>
                </div>
                
                <div>
                    <h3 class="font-semibold text-purple-300 mb-2">External Resource Detection:</h3>
                    <pre class="bg-gray-900 p-3 rounded overflow-x-auto"><code>const hasExternalBase = html.includes('base href="http') && 
  (html.includes('cdn.jsdelivr.net') || 
   html.includes('github.io') || 
   html.includes('googleapis.com'));</code></pre>
                </div>
                
                <div>
                    <h3 class="font-semibold text-purple-300 mb-2">Auto-Redirect Function:</h3>
                    <pre class="bg-gray-900 p-3 rounded overflow-x-auto"><code>window.redirectToGame = function(gameUrl) {
  let redirectUrl = gameUrl.replace('/index.html', '/');
  window.open(redirectUrl, '_blank');
  trackGameActivity(currentGameId, 'auto-redirected');
};</code></pre>
                </div>
            </div>
        </div>

        <!-- User Instructions -->
        <div class="mt-8 bg-blue-900/20 border border-blue-500/30 rounded-lg p-6">
            <h2 class="text-xl font-semibold mb-4 text-blue-400">
                <i class="bx bx-info-circle"></i>
                How the New System Works
            </h2>
            <ol class="list-decimal list-inside space-y-2 text-gray-300">
                <li>Game loads in iframe with loading overlay</li>
                <li>System detects if game has external CDN dependencies</li>
                <li>If game doesn't load within 8 seconds, shows fallback options</li>
                <li>User can click "Open in New Tab" for immediate access</li>
                <li>Or click "Try Again" to retry iframe loading</li>
                <li>All tracking and profile integration still works perfectly</li>
            </ol>
        </div>
    </div>
</body>
</html>